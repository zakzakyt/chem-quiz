<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="google-site-verification" content="sgJmgQeuXZ41wG74J3_lR81T8bAys4hFCBpR_S4-K2M" />

    <title>æœ‰æ©ŸåŒ–å­¦æ§‹é€ æ±ºå®šã‚¯ã‚¤ã‚º - 31ç¨®é¡ã®åŒ–åˆç‰©ã‚’ç‰¹å®šã›ã‚ˆï¼</title>
    <meta name="description" content="å¤§å­¦å…¥è©¦ãƒ¬ãƒ™ãƒ«ã®æœ‰æ©ŸåŒ–åˆç‰©ã‚’ç‰¹å®šã™ã‚‹ã‚¢ã‚­ãƒãƒ¼ã‚¿ãƒ¼é¢¨ã‚¯ã‚¤ã‚ºã€‚éŠ€é¡åå¿œã‚„ä¸æ–‰ç‚­ç´ ãªã©ã®æ€§è³ªã‹ã‚‰ã€ã„ã‹ã«å°‘ãªã„è³ªå•ã§æ§‹é€ ã‚’æ±ºå®šã§ãã‚‹ã‹æŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ã€‚">
    <meta name="keywords" content="æœ‰æ©ŸåŒ–å­¦, æ§‹é€ æ±ºå®š, åŒ–å­¦, ã‚¯ã‚¤ã‚º, å¤§å­¦å…¥è©¦, å…±é€šãƒ†ã‚¹ãƒˆ, å­¦ç¿’ã‚¢ãƒ—ãƒª">
    <meta name="author" content="Your Name">

    <meta property="og:title" content="æœ‰æ©ŸåŒ–å­¦æ§‹é€ æ±ºå®šã‚¯ã‚¤ã‚º">
    <meta property="og:description" content="å›ã¯å°‘ãªã„è³ªå•ã§åŒ–åˆç‰©ã‚’ç‰¹å®šã§ãã‚‹ã‹ï¼Ÿå…¨31ç¨®é¡ã®æœ‰æ©ŸåŒ–åˆç‰©ã«å¯¾å¿œï¼">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://chem-quiz.onrender.com"> <meta property="og:image" content="https://chem-quiz.onrender.com/images/benzene.png"> <meta name="twitter:card" content="summary_large_image">

    <style>
        :root {
            --primary-color: #4a90e2;
            --bg-color: #f4f7f6;
            --text-color: #333;
        }
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container { max-width: 600px; width: 100%; display: flex; flex-direction: column; gap: 20px; }
        
        .turn-badge {
            background: #2c3e50;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .card h3 {
            margin-top: 0;
            color: var(--primary-color);
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
        }

        .control-group { margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        select, input { padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; }
        
        button { border: none; padding: 12px 20px; border-radius: 6px; color: white; cursor: pointer; font-weight: bold; width: 100%; transition: opacity 0.2s; font-size: 1rem; }
        button:hover { opacity: 0.9; }
        
        .btn-ask { background-color: var(--primary-color); }
        .btn-guess { background-color: #e67e22; }
        .btn-giveup { background-color: #95a5a6; margin-top: 10px; font-size: 0.9rem; }
        
        /* ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ï¼ˆçµ±åˆç‰ˆï¼‰ */
        .btn-start { background-color: #27ae60; font-size: 1.2rem; padding: 15px; margin-top: 10px; }

        .hidden { display: none !important; }

        #overlay-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 90%;
            width: 450px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .rank-text { font-size: 2.5rem; color: #e67e22; margin: 10px 0; font-weight: bold; }
        
        #logs { display: flex; flex-direction: column; gap: 10px; padding-bottom: 50px; }
        .log-item { padding: 12px; border-radius: 8px; background: white; border-left: 5px solid #ccc; display: flex; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .log-item.yes { border-left-color: #27ae60; background: #eafaf1; }
        .log-item.no { border-left-color: #e74c3c; background: #fdedec; }
        .log-item.giveup { border-left-color: #95a5a6; background: #f4f4f4; color: #7f8c8d; }
    </style>
</head>
<body>

<div id="overlay-screen">
    <div id="start-content" class="modal-box">
        <h1>ğŸ§ª Organic Quiz</h1>
        <p>å…¨31ç¨®é¡ã®æœ‰æ©ŸåŒ–åˆç‰©ã‹ã‚‰<br>æ­£è§£ã‚’ç‰¹å®šã—ã¦ãã ã•ã„</p>
        <button class="btn-start" onclick="startGame()">
            ğŸš€ ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ
        </button>
    </div>

    <div id="result-content" class="modal-box" style="display:none;">
        <h2 id="result-title" style="margin:0; color:#27ae60;">ğŸ‰ CONGRATULATIONS!</h2>
        <p>æ­£è§£ã¯ <b id="result-name" style="font-size:1.4em;"></b> ã§ã—ãŸã€‚</p>
        <p id="result-formula" style="font-size: 1.5em; font-family: 'Times New Roman', serif; margin: 5px 0; color: #555; letter-spacing: 1px;"></p>
        
        <div style="margin: 15px 0; min-height: 100px; display: flex; justify-content: center; align-items: center;">
            <img id="result-image" src="" alt="æ§‹é€ å¼" style="display:none; max-width: 100%; height: auto; max-height: 200px; border: 1px solid #ddd; border-radius: 8px; padding: 5px;">
        </div>

        <div class="rank-text" id="result-rank"></div>
        <p>è¨˜éŒ²: <b id="result-turns"></b> ã‚¿ãƒ¼ãƒ³</p>
        <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
        
        <button class="btn-start" style="margin:0;" onclick="startGame()">
            ğŸ”„ ã‚‚ã†ä¸€åº¦éŠã¶
        </button>
    </div>
</div>

<div class="container">
    <header style="text-align: center;">
        <h1>ğŸ§ª Organic Chem Quiz</h1>
        <div class="turn-badge">
            ç¾åœ¨: <span id="turn-display">0</span> ã‚¿ãƒ¼ãƒ³ç›®
        </div>
    </header>

    <div class="card">
        <h3>ğŸ” è³ªå•ã™ã‚‹</h3>
        <div class="control-group">
            <select id="target" style="flex:2;" onchange="updateFormUI()">
                <optgroup label="åŸå­ã®æ•°">
                    <option value="C">ç‚­ç´ åŸå­ (C)</option>
                    <option value="H">æ°´ç´ åŸå­ (H)</option>
                    <option value="O">é…¸ç´ åŸå­ (O)</option>
                    <option value="N">çª’ç´ åŸå­ (N)</option>
                </optgroup>
                <optgroup label="çµåˆãƒ»æ§‹é€ ">
                    <option value="double_bond">ç‚­ç´ é–“äºŒé‡çµåˆ (C=C)</option>
                    <option value="triple_bond">ä¸‰é‡çµåˆ (Câ‰¡C)</option>
                    <option value="ring_benzene">ãƒ™ãƒ³ã‚¼ãƒ³ç’°</option>
                    <option value="is_chiral" data-type="bool">ä¸æ–‰ç‚­ç´ åŸå­ (â€»å…‰å­¦ç•°æ€§ä½“)</option>
                </optgroup>
                <optgroup label="å®˜èƒ½åŸº">
                    <option value="group_oh">ãƒ’ãƒ‰ãƒ­ã‚­ã‚·åŸº (-OH)</option>
                    <option value="group_cooh">ã‚«ãƒ«ãƒœã‚­ã‚·åŸº (-COOH)</option>
                    <option value="group_cho">ã‚¢ãƒ«ãƒ‡ãƒ’ãƒ‰åŸº (-CHO)</option>
                    <option value="group_co">ã‚±ãƒˆãƒ³åŸº (-CO-)</option>
                    <option value="group_ether">ã‚¨ãƒ¼ãƒ†ãƒ«çµåˆ (-O-)</option>
                    <option value="group_ester">ã‚¨ã‚¹ãƒ†ãƒ«çµåˆ (-COO-)</option>
                    <option value="group_nh2">ã‚¢ãƒŸãƒåŸº (-NHâ‚‚)</option>
                </optgroup>
                <optgroup label="åå¿œãƒ»æ€§è³ª">
                    <option value="reaction_acid" data-type="bool">é…¸æ€§ã‚’ç¤ºã™ (é’è‰²ãƒªãƒˆãƒã‚¹ç´™ã‚’èµ¤å¤‰)</option>
                    <option value="reaction_silver" data-type="bool">éŠ€é¡åå¿œã‚’ç¤ºã™ (é‚„å…ƒæ€§ã‚ã‚Š)</option>
                    <option value="reaction_iodoform" data-type="bool">ãƒ¨ãƒ¼ãƒ‰ãƒ›ãƒ«ãƒ åå¿œã‚’ç¤ºã™</option>
                    <option value="reaction_fe" data-type="bool">å¡©åŒ–é‰„(III)ã§ç´«ã‚’å‘ˆã™ã‚‹ (ãƒ•ã‚§ãƒãƒ¼ãƒ«é¡)</option>
                    <option value="reaction_sodium" data-type="bool">é‡‘å±ãƒŠãƒˆãƒªã‚¦ãƒ ã¨åå¿œã—ã¦æ°´ç´ ç™ºç”Ÿ</option>
                    <option value="reaction_bromine" data-type="bool">è‡­ç´ æ°´ã‚’è„±è‰²ã™ã‚‹ (ä¸é£½å’Œçµåˆ)</option>
                    <option value="reaction_dehydrate" data-type="bool">åŠ ç†±ã™ã‚‹ã¨è„±æ°´ã—ã¦é…¸ç„¡æ°´ç‰©ã«ãªã‚‹</option>
                </optgroup>
            </select>
        </div>

        <div id="numeric-input-area" class="control-group">
            <span>ã®æ•°ãŒ</span>
            <input type="number" id="value" value="1" min="0" style="flex:1;">
            <select id="operator" style="flex:1;">
                <option value="equal">ã¨åŒã˜</option>
                <option value="gte">ä»¥ä¸Š (â‰§)</option>
                <option value="lte">ä»¥ä¸‹ (â‰¦)</option>
            </select>
            <span>ã§ã™ã‹ï¼Ÿ</span>
        </div>

        <div id="boolean-text-area" class="control-group hidden">
            <span style="font-weight: bold; font-size: 1.1rem; color: #555;">ã‚’ç¤ºã—ã¾ã™ã‹ï¼Ÿ (Yes / No)</span>
        </div>

        <button class="btn-ask" onclick="askQuestion()">è³ªå•ã‚’é€ä¿¡</button>
    </div>

    <div class="card">
        <h3>ğŸ’¡ åå‰ã‚’ç­”ãˆã‚‹</h3>
        <div class="control-group">
            <input type="text" id="guessName" placeholder="åŒ–åˆç‰©åã‚’å…¥åŠ› (ä¾‹: ãƒ™ãƒ³ã‚¼ãƒ³)" style="width: 100%;">
        </div>
        <button class="btn-guess" onclick="guessAnswer()">å›ç­”ã™ã‚‹</button>
        <button class="btn-giveup" onclick="giveUp()">é™å‚ã—ã¦ç­”ãˆã‚’è¦‹ã‚‹...</button>
    </div>

    <div id="logs"></div>
</div>

<script>
    // UIåˆ‡ã‚Šæ›¿ãˆ
    function updateFormUI() {
        const targetSelect = document.getElementById('target');
        const selectedOption = targetSelect.options[targetSelect.selectedIndex];
        
        const isBoolean = selectedOption.getAttribute('data-type') === 'bool' 
                          || selectedOption.value.startsWith('reaction_') 
                          || selectedOption.value === 'is_chiral';

        const numericArea = document.getElementById('numeric-input-area');
        const booleanArea = document.getElementById('boolean-text-area');

        if (isBoolean) {
            numericArea.classList.add('hidden');
            booleanArea.classList.remove('hidden');
        } else {
            numericArea.classList.remove('hidden');
            booleanArea.classList.add('hidden');
        }
    }

    // ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ˆå¼•æ•°ãªã—ï¼‰
    async function startGame() {
        await fetch('/api/reset', { 
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({}) // é›£æ˜“åº¦ã¯é€ã‚‰ãªã„
        });
        document.getElementById('logs').innerHTML = '';
        document.getElementById('guessName').value = '';
        updateTurn(0);
        document.getElementById('overlay-screen').style.display = 'none';
        document.getElementById('start-content').style.display = 'block';
        document.getElementById('result-content').style.display = 'none';
        
        document.getElementById('target').selectedIndex = 0;
        updateFormUI();
        window.scrollTo(0,0);
    }

    // è³ªå•
    async function askQuestion() {
        const targetSelect = document.getElementById('target');
        const target = targetSelect.value;
        const selectedOption = targetSelect.options[targetSelect.selectedIndex];
        
        const isBoolean = selectedOption.getAttribute('data-type') === 'bool' 
                          || target.startsWith('reaction_') 
                          || target === 'is_chiral';
        
        let value, operator;
        if (isBoolean) {
            value = 1;
            operator = 'equal';
        } else {
            value = document.getElementById('value').value;
            operator = document.getElementById('operator').value;
        }

        const targetText = selectedOption.text;

        const response = await fetch('/api/ask', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ target, value, operator })
        });

        const data = await response.json();
        updateTurn(data.currentTurn);
        const isYes = data.answer === "ã¯ã„";

        let questionText = "";
        if (isBoolean) {
            questionText = `Q. ${targetText} ã‚’ç¤ºã—ã¾ã™ã‹ï¼Ÿ`;
            if (target === 'is_chiral') questionText = "Q. ä¸æ–‰ç‚­ç´ åŸå­ã‚’æŒã£ã¦ã„ã¾ã™ã‹ï¼Ÿ";
        } else {
            const opText = getOpText(operator);
            questionText = `Q. ${targetText} ã¯ ${value} ${opText} ã§ã™ã‹ï¼Ÿ`;
        }
        
        addLog(questionText, `A. ${data.answer} ${isYes ? 'â­•' : 'âŒ'}`, isYes ? "yes" : "no");
    }

    // å›ç­”
    async function guessAnswer() {
        const name = document.getElementById('guessName').value;
        if(!name) return;

        const response = await fetch('/api/guess', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name })
        });

        const data = await response.json();
        
        if (data.correct) {
            showResult(name, data.finalTurn, data.image, data.formula, false);
        } else {
            updateTurn(data.currentTurn);
            alert("é•ã„ã¾ã™...");
            addLog(`å›ç­”: ${name}`, "ä¸æ­£è§£... ğŸ’¨", "no");
        }
    }

    // ã‚®ãƒ–ã‚¢ãƒƒãƒ—
    async function giveUp() {
        if(!confirm("æœ¬å½“ã«é™å‚ã—ã¾ã™ã‹ï¼Ÿ")) return;
        const response = await fetch('/api/giveup', { method: 'POST' });
        const data = await response.json();
        addLog("é™å‚ã—ã¾ã—ãŸ...", "Give Up", "giveup");
        showResult(data.name, data.turnCount, data.image, data.formula, true);
    }

    // çµæœè¡¨ç¤ºï¼ˆâ˜…ãƒ©ãƒ³ã‚¯åŸºæº–ã‚’ä¸­é–“è¨­å®šã«çµ±ä¸€ï¼‰
    function showResult(name, turns, imageFile, formula, isGiveUp) {
        const titleEl = document.getElementById('result-title');
        const rankEl = document.getElementById('result-rank');

        document.getElementById('result-name').innerText = name;
        document.getElementById('result-turns').innerText = turns;
        
        const formulaEl = document.getElementById('result-formula');
        if (formula) {
            formulaEl.innerHTML = formula.replace(/(\d+)/g, "<sub>$1</sub>");
        } else {
            formulaEl.innerText = "";
        }

        const imgElement = document.getElementById('result-image');
        if (imageFile) {
            imgElement.src = "/images/" + imageFile;
            imgElement.style.display = "inline-block";
        } else {
            imgElement.style.display = "none";
        }

        if (isGiveUp) {
            titleEl.innerText = "ğŸ˜µ GIVE UP...";
            titleEl.style.color = "#7f8c8d";
            rankEl.innerText = "";
        } else {
            titleEl.innerText = "ğŸ‰ CONGRATULATIONS!";
            titleEl.style.color = "#27ae60";
            
            // â˜…æ–°ã—ã„ãƒ©ãƒ³ã‚¯åŸºæº–ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰çµ±ä¸€ï¼‰
            // S: 5ã‚¿ãƒ¼ãƒ³ä»¥å†… (ç†è«–å€¤)
            // A: 8ã‚¿ãƒ¼ãƒ³ä»¥å†… (å°‘ã—ä½™è£•)
            // B: 12ã‚¿ãƒ¼ãƒ³ä»¥å†… (æ¢ç´¢çš„)
            let rank = "C";
            if (turns <= 5) rank = "S (ç¥æ¥­)";
            else if (turns <= 8) rank = "A (å„ªç§€)";
            else if (turns <= 12) rank = "B (æ™®é€š)";
            
            rankEl.innerText = rank;
        }

        document.getElementById('overlay-screen').style.display = 'flex';
        document.getElementById('start-content').style.display = 'none';
        document.getElementById('result-content').style.display = 'block';
    }

    function updateTurn(count) {
        document.getElementById('turn-display').innerText = count;
    }

    function addLog(q, a, type) {
        const div = document.createElement('div');
        div.className = `log-item ${type}`;
        div.innerHTML = `<span>${q}</span><span style="font-weight:bold">${a}</span>`;
        document.getElementById('logs').prepend(div);
    }

    function getOpText(op) {
        if(op === 'equal') return 'ã¨åŒã˜';
        if(op === 'gte') return 'ä»¥ä¸Š';
        if(op === 'lte') return 'ä»¥ä¸‹';
    }

    window.onload = updateFormUI;
</script>

</body>
</html>